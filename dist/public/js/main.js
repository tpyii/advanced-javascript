(()=>{"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function e(e){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?t(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}new Vue({el:"#app",components:{basket:{data:function(){return{url:"/api/cart",basketShow:!1,basketGoodThumbnail:"https://via.placeholder.com/100",basket:{}}},components:{"basket-header":{template:'\n    <div class="basket-header">\n      <h2>Корзина</h2>\n      <button class="btn-close" @click="$parent.basketShow = false">X</button>\n    </div>\n  '},"basket-items":{components:{"basket-item":{props:["item","img"],template:'\n    <div class="basket-item" >\n      <div class="basket-image">\n        <img :src="img" alt="">\n      </div>\n      <div class="basket-body">\n        <h3 class="basket-item-title">{{ item.product_name }}</h3>\n        <p>{{ item.price }}</p>\n        <button class="btn-remove" @click="$root.$refs.basket.removeBasketGood(item)">Удалить</button>\n      </div>\n      <div class="basket-quanity">{{ item.quantity }}</div>\n    </div>\n  '}},template:'\n    <div class="basket-items">\n      <div v-if="!$parent.basket.countGoods">Корзина пуста</div>\n      <basket-item \n        v-for="item in $parent.basket.contents" \n        :item="item"\n        :img="$parent.basketGoodThumbnail"\n        :key="item.id_product"\n      ></basket-item>\n    </div>\n  '},"basket-amount":{template:'<div class="basket-amount" v-if="$parent.basket.amount">Товаров на сумму: {{ $parent.basket.amount }}</div>'}},mounted:function(){var t=this;this.$root.get(this.url).then((function(e){return t.basket=e}))},methods:{addBasketGood:function(t){var n=this,o=this.basket.contents.find((function(e){return e.id_product===t.id_product}));o?this.$root.update("".concat(this.url,"/").concat(o.id_product),{quantity:1}).then((function(t){1===t.result&&o.quantity++})):(o=e(e({},t),{},{quantity:1}),this.$root.add(this.url,o).then((function(t){1===t.result&&n.basket.contents.push(o)}))),this.calcBasket(),this.basketShow=!0},removeBasketGood:function(t){var e=this;this.$root.remove("".concat(this.url,"/").concat(t.id_product)).then((function(n){if(1===n.result){var o=e.basket.contents.find((function(e){return e.id_product===t.id_product}));o.quantity>1?o.quantity--:e.basket.contents.splice(e.basket.contents.findIndex((function(e){return e.id_product===t.id_product})),1),e.calcBasket()}}))},calcBasket:function(){this.calcAmount(),this.basketCountGoods()},calcAmount:function(){this.basket.amount=this.basket.contents.reduce((function(t,e){return t+e.price*e.quantity}),0)},basketCountGoods:function(){this.basket.countGoods=this.basket.contents.reduce((function(t,e){return t+e.quantity}),0)}},template:'\n    <div id="basket" v-bind:class="{ show: basketShow }">\n      <basket-header></basket-header>\n      <basket-items></basket-items>\n      <basket-amount></basket-amount>\n    </div>\n  '},error:{data:function(){return{text:""}},computed:{isVisible:function(){return""!==this.text}},template:'\n    <div class="error" v-bind:class="{ show: isVisible }">\n      {{ text }} \n      <button class="btn-close" @click="text=\'\'">X</button>\n    </div>\n  '},products:{data:function(){return{url:"/api/products",goodsThumbnail:"https://via.placeholder.com/200",goods:[],filteredGoods:[]}},components:{"product-item":{props:["item","img"],template:'\n    <div class="product-item">\n      <img :src="img" alt="">\n      <h3>{{ item.product_name }}</h3>\n      <p>{{ item.price }}</p>\n      <button class="btn-buy" @click="$root.$refs.basket.addBasketGood(item)">Купить</button>\n    </div>\n  '}},mounted:function(){var t=this;this.$root.get(this.url).then((function(e){t.goods=e,t.filteredGoods=e}))},methods:{filterGoods:function(t){var e=new RegExp(t,"i");this.filteredGoods=this.goods.filter((function(t){return e.test(t.product_name)}))}},template:'\n    <div class="products">\n      <div v-if="!goods.length">Нет данных</div>\n      <product-item \n        v-for="item in filteredGoods" \n        :item="item"\n        :img="goodsThumbnail"\n        :key="item.id_product"\n      ></product-item>\n    </div>\n  '},search:{data:function(){return{searchValue:""}},template:'\n    <input \n      type="text" \n      name="search" \n      class="header-search" \n      placeholder="Поиск по товарам" \n      v-model="searchValue" \n      @input="$root.$refs.products.filterGoods(searchValue)"\n    >\n  '}},methods:{get:function(t){var e=this;return fetch(t).then((function(t){return t.json()})).catch((function(t){return e.$refs.error.text=t}))},add:function(t,e){var n=this;return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.json()})).catch((function(t){return n.$refs.error.text=t}))},update:function(t,e){var n=this;return fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.json()})).catch((function(t){return n.$refs.error.text=t}))},remove:function(t){var e=this;return fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()})).catch((function(t){return e.$refs.error.text=t}))}}})})();